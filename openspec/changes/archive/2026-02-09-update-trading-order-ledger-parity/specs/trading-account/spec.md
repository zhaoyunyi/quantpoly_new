## ADDED Requirements

### Requirement: 订单生命周期必须完整可追踪
交易账户 MUST 提供订单创建、撤销、成交与查询能力，并通过状态机约束状态迁移。

#### Scenario: 订单从 pending 迁移为 filled
- **GIVEN** 用户提交买入订单且订单处于 `pending`
- **WHEN** 订单被执行成交
- **THEN** 订单状态迁移为 `filled`
- **AND** 生成关联成交记录

#### Scenario: 非法状态迁移被拒绝
- **GIVEN** 订单已处于 `cancelled`
- **WHEN** 再次请求成交确认
- **THEN** 返回 409
- **AND** 不生成额外成交记录

### Requirement: 账本事件必须保证资金与记录一致
成交与资金流水 MUST 在事务内保持一致，任何失败都应回滚。

#### Scenario: 成交写入失败触发回滚
- **GIVEN** 订单成交流程进入资金与流水写入阶段
- **WHEN** 流水写入失败
- **THEN** 账户余额与订单状态回滚到变更前
- **AND** 返回可识别的事务失败错误码

### Requirement: 交易读模型必须提供统计与概览能力
交易账户 MUST 提供订单、成交、资金流水及账户概览统计查询接口。

#### Scenario: 用户查询账户概览
- **GIVEN** 用户账户已有成交与持仓数据
- **WHEN** 调用账户概览接口
- **THEN** 返回总资产、可用资金、浮动盈亏等指标
- **AND** 结果仅包含当前用户可访问账户
