# 能力门禁 Given/When/Then 场景清单

## 场景 1：认证登录能力

- **Given** 用户已注册并完成邮箱验证
- **When** 用户提交正确邮箱密码登录
- **Then** 系统返回有效会话令牌
- **And** 后续受保护接口可通过该令牌访问

## 场景 2：策略列表能力

- **Given** 用户已创建策略
- **When** 用户请求 `GET /strategies`
- **Then** 返回仅属于当前用户的数据

## 场景 3：回测任务幂等提交能力

- **Given** 用户对同一回测请求提交相同 `idempotencyKey`
- **When** 连续提交两次回测任务
- **Then** 返回同一任务语义，不得重复创建任务

## 场景 4：交易写路径能力

- **Given** 用户存在可用模拟账户
- **When** 用户提交下单并成交
- **Then** 订单状态、成交记录、资金流水一致更新

## 场景 5：风控告警处置能力

- **Given** 存在未解决风险告警
- **When** 用户执行确认与解决
- **Then** 告警状态正确迁移且可审计

## 场景 6：监控摘要能力

- **Given** 系统存在信号与告警数据
- **When** 用户请求 `/monitor/summary`
- **Then** 返回结构化摘要并仅包含当前用户可访问范围

## 场景 7：实时监控通道能力

- **Given** 用户携带有效会话令牌
- **When** 连接 `/ws/monitor`
- **Then** 连接建立并收到标准 heartbeat 消息
